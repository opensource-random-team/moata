<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">
<th:block layout:fragment="content">
    <p>
		<head>
		    <meta charset="UTF-8">
		    <meta name="viewport" content="width=device-width, initial-scale=1.0">
		    <title>Moata 커뮤니티</title>
		    <script src="https://cdn.tailwindcss.com"></script>
		    <link rel="stylesheet" href="styles.css">
		</head>
		<body class="min-h-screen bg-white">
		    <div class="container mx-auto px-4 py-8">
		        <!-- Page Header -->
		        <div class="mb-8">
		            <div class="flex items-center justify-between mb-6">
		                <div>
		                    <h1 class="text-4xl font-bold mb-2">커뮤니티</h1>
		                    <p class="text-xl text-gray-600">택시 공유 경험을 나누고 유용한 정보를 공유해보세요</p>
		                </div>
		                <a href="/community_write">
		                    <button class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow-lg">글쓰기</button>
		                </a>
		            </div>

		            <!-- Search -->
		            <form action="/community_search" method="post" class="mb-6">
		                <input id="searchInput" name="key" type="text" th:value="${key}" placeholder="게시글 검색..." 
		                       class="w-full px-4 py-3 border border-blue-200 rounded-lg pl-10">
		            </form>

		            <!-- Category Tabs -->
		           
				   <a th:href="@{/community(category='전체')}"
					   class="px-4 py-2 rounded-lg text-sm inline-block"
					   th:classappend="${selectedCategory == null || selectedCategory == '전체'} 
					                    ? ' bg-blue-600 text-white'
					                    : ' border'">
					    전체 <span class="ml-1">[[${postCount}]]</span>
					</a>
					
					<a th:href="@{/community(category='자유')}"
					   class="px-4 py-2 rounded-lg text-sm inline-block"
					   th:classappend="${selectedCategory == '자유'} 
					                    ? ' bg-blue-600 text-white'
					                    : ' border'">
					    자유
					</a>
					
					<a th:href="@{/community(category='팟 구해요')}"
					   class="px-4 py-2 rounded-lg text-sm inline-block"
					   th:classappend="${selectedCategory == '팟 구해요'} 
					                    ? ' bg-blue-600 text-white'
					                    : ' border'">
					    팟 구해요
					</a>
					
					<a th:href="@{/community(category='꿀팁')}"
					   class="px-4 py-2 rounded-lg text-sm inline-block"
					   th:classappend="${selectedCategory == '꿀팁'} 
					                    ? ' bg-blue-600 text-white'
					                    : ' border'">
					    꿀팁
					</a>
					<a th:href="@{/community(category='질문')}"
					   class="px-4 py-2 rounded-lg text-sm inline-block"
					   th:classappend="${selectedCategory == '질문'} 
					                    ? ' bg-blue-600 text-white'
					                    : ' border'">
					    질문
					</a>
									   

		        </div>

		        <div class="grid lg:grid-cols-4 gap-8">
		            <!-- Main Content -->
		        <div class="lg:col-span-3 space-y-6">

				<div th:if="${#lists.isEmpty(postList)}" class="text-center text-gray-500 mb-4">
			    검색 결과가 없습니다.
			</div>
			
			

			    <!-- DB에서 받아온 postList 반복 -->
			    <div th:each="post : ${postList}">
			        <a th:href="@{'/community_detail/' + ${post.id}}"> <!-- 포스트 아이디로 반환 -->
			            <div class="bg-white border rounded-lg p-6 hover:shadow-xl transition cursor-pointer"
            					 th:classappend="${post.off == 1} ? ' opacity-50' : ''">
			            
			            
			                <div class="flex items-start gap-4">
			                    <div class="w-12 h-12 bg-blue-500 rounded-full"></div>
			
			                    <div class="flex-1">
			
			                        <!-- 카테고리 + 날짜 -->
			                        <div class="flex items-center gap-2 mb-2">
			                   
										<span class="text-blue-600">[[${post.user.userId}]]</span>
											
			                            <span class="border text-xs px-2 py-1 rounded"
			                                  th:text="${post.category}">카테고리</span>
			
			                            <span class="text-sm text-gray-500"
			                                  th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">
			                                작성일
			                            </span>
			                        </div>
			
			                        <!-- 제목 -->
			                        <h3 class="text-lg font-semibold mb-2">
									    <span th:if="${post.off == 1}" class="text-blue-600 font-bold">
									        [모집 종료]
									    </span>
									    <span th:text="${post.title}"></span>
									</h3>


			
			                        <!-- 내용 일부 -->
			                        <p class="text-gray-600 mb-3 line-clamp-2" 
			                           th:text="${post.content}">내용 미리보기...</p>
			
									<br>
			                        <div class="flex items-center justify-between">
			                            <div class="flex items-center gap-4 text-sm text-gray-600">
			                                <span>❤️ 0</span>
			                                <span>댓글 0</span>
			                                <span th:text="'조회수 ' + ${post.viewCnt}"></span>
			                            </div>
			                        </div>
			
			                    </div>
			                </div>
			            </div>
			           
			        </a>
			</div>
			<br>		            

			</div>
		        
		         <!-- Sidebar -->
		        <div class="space-y-6">
		                <div class="bg-white border rounded-lg p-4 shadow-lg">
		                    <h3 class="font-semibold mb-4">커뮤니티 현황</h3>
		                    <div class="space-y-3">
		                        <div class="flex justify-between">
		                            <span class="text-sm">전체 회원</span>
		                            <span class="font-semibold">[[${userCount}]]</span>
		                        </div>
		                        <div class="flex justify-between">
		                            <span class="text-sm">모든 게시글</span>
		                            <span class="font-semibold">[[${postCount}]]</span>
		                        </div>
		                    </div>
		                </div>
		            </div>
		    </div>
		    
		    <br>

		    <!-- JavaScript 추가 및 검색 기능 구현 -->
		    <script src="app.js"></script>
		    <script>
		        document.addEventListener('DOMContentLoaded', () => {
		            const searchInput = document.getElementById('searchInput');
		            
		            searchInput.addEventListener('input', (e) => {
		                const query = e.target.value.toLowerCase();
		                // 실제로는 게시글을 필터링하는 로직 구현
		                console.log('검색어:', query);
		            });
		        });
		    </script>
		</body>
    </p>
</th:block>
</html>